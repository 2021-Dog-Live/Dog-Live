# Dog-Live 💻포팅 매뉴얼💻

> SSAFY 5기 공통프로젝트 서울 5반 1팀 견과류

[💌독립 사용 설명서💌](https://www.notion.so/87e8c174f17342488f0fad86493f777e)

<br><br>

## 📖 목차

[ 📑 개발 환경 세팅 ](#-개발-환경-세팅)

[ 📑 계정 정보 ](#-계정-정보)

[ 📑 프로퍼티 파일 정보 ](#-프로퍼티-파일-목록)

[ 📑 빌드 및 배포 방법 ](#-빌드-및-배포-방법)

[ 📑 외부 서비스 ](#-외부-서비스)

<br><br>

## 🛠 개발 환경 세팅

- OS : Windows 10

- Server : AWS EC2
    - Ubuntu 20.04.1
    - Docker 20.10.8
<br>

- Backend
    - Java : Java 1.8.0
    - Framework : SpringBoot 2.4.5
    - ORM : JPA(Hibernate)
    - Nginx : 1.18.0 (Ubuntu)
    - IDE : Intellij 2021.1.3 / Visual Studio Code 1.59
    - Dependency tool : gradle-6.7
    - Database : MariaDB-10.3.31
    - Image Server : AWS S3 & CloudFront
<br>

- Frontend
    - HTML5, CSS3, Javascript(Es6)
    - Vue 3.0.0
    - @vue/cli 4.5.0
    - Vuex 4.0.0
    - Vue-axios 3.2.4

<br><br>

## 🔒 계정 정보

- DB 접속 정보
    - ID : dogvlie
    - PW : doglivedoggi

<br>

- Jenkins 접속 정보
    - ID : admin
    - PW : doglivedoggi
    - Jenkins 관리자 페이지
        - `http://i5a501.p.ssafy.io:9090` 로 접속
            - 주의 : https가 아니라 **http** 입니다!


<br><br>


## 🔑프로퍼티 파일 목록

```bash
backend
└── src
	└──main
		└──resources
			├── application.yaml
			└── application-aws.yaml
```

- `application.yaml` (프로젝트 셋팅, 배포 셋팅, DB 셋팅 정보)  
- `application-aws.yaml` (S3 서버 accessKey, secretKey 정보)  

<br><br>

## 📢 빌드 및 배포 방법

### 1. 로컬 실행 가이드

1. Project Git Clone : 

    ```bash
    $ git clone https://lab.ssafy.com/s05-webmobile1-sub3/S05P13A501
    ```

<br>

2. Test

    ```bash
    $ cd backend/build/libs
    $ java -jar common-project-1.0-SNAPSHOT.jar
    ```

    `https://localhost:8081` 로 들어가서 확인한다.

<br>

3. IDE로 프로젝트 Import
    - Intellij 기준
        - File > New > Project from Existing sources > 프로젝트 경로 선택 > import 방식 gradle  
    - 프로젝트 실행 : Gradle Project > bootRun  
    - 브라우저에서 `https://localhost:8081`로 접속  

    - 로컬 실행 시 로그인 기능을 이용하려면 Redirect URI를 변경해주어야, 로그인 후 로컬 페이지로 Redirect된다.  
        (현재는 배포 사이트로 Redirect 되도록 셋팅되어 있음)  
 
    - 로컬 실행 시 채팅 기능을 이용하려면 URI를 변경해주어야 채팅이 원활하게 작동된다.  
        (현재는 배포 사이트 기준으로 URI가 셋팅되어 있음)  

<br><br>

### 2. 배포 가이드

1. 직접 빌드 후 배포
- 프로젝트 직접 빌드

    ```bash
    $cd S05P13A501/backend
     $./gradlew clean build
    ```

<br>

- 프로젝트 실행

     ```bash
    $cd S05P13A501/backend/build/libs
    $java -jar common-project-1.0-SNAPSHOT.jar
    ```

    `https://i5a501.p.ssafy.io/` 로 접속

<br>

2. Jenkins를 이용한 자동 빌드 및 배포
- Jenkins 관리자 페이지
    - `http://i5a501.p.ssafy.io:9090` 로 접속
        - 주의 : https가 아니라 **http** 입니다!

<br>

- 직접 프로젝트 실행

    ```bash
    $cd /var/lib/jenkins/workspace/build/backend/build/libs

    $java -jar common-project-1.0-SNAPSHOT.jar
    ```


<br><br>

## 📡 외부 서비스

### 1. 카카오 API
  
- 카카오계정과 본 애플리케이션을 연결하고 토큰을 발급받아 카카오 API를 사용    
- 직접 서비스 ID 및 비밀번호를 입력받고 검증하는 과정을 구현하는 대신,  
     카카오 로그인을 통해 사용자를 인증하고 회원 정보를 수집
- 카카오 API가 제공되지 않는 가입 및 탈퇴 등 회원 정보에 대한 처리는 서비스에서 자체적으로 구현  

- 환경설정

    ```bash
    backend
    └── src
    	└──java
    		└──resources
    			└──com
    				└──ssafy
    					└──api
    						└──service
    							└── KakaoAPI.java
    ```

<br>

- `KakaoAPI.java`의 `APPKEY`를 내 애플리케이션의 REST API로 셋팅
(이미 셋팅되어 있으므로 변경할 필요 없다)  

    - 카카오 로그인을 위한 RESTAPI key
        `bacd72f58ac01490602415c683ad8c05`  

    - 카카오 공유하기를 위한 Javascript key 
        `d0106aa9ba1feb9c379bbb82194695fe`  
        
    ![image](/uploads/7e45b46929e0edcb9e0087e2222da08d/image.png)  

<br>

- **로컬 테스트** 시 미리 설정해 놓은 **`redirect URI`**를 바꿔주어야,

    로그인 후에 로컬 페이지로 redirect된다.

    (현재 설정은 배포 페이지로 redirect 되도록 셋팅)

    - **redirect URI** 변경법

        1. Backend
            a. KakaoApi.java

            ```bash
                backend
                └── src
                    └──java
                    	└──resources
                    		└──com
                    			└──ssafy
                    				└──api
                    					└──service
                    						└── KakaoAPI.java
            ```

            ![image](/uploads/aa478f1c7d1ccc5b984659423dee2431/image.png)

            38, 39번 라인의 `redirect_uri`를 현재 환경에 맞는 `URI`로 변경시켜주고, 해당 하지 않는 URI는 주석처리한다.

            - `https://i5a501.p.ssafy.io/kakao/callback` : 배포용

            - `https://localhost:8082/kakao/callback` : 로컬테스트용

<br>

        2. Frontend
            1. login-dialog.vue

            ```bash
                frontend
                └── src
                    └── views
                    	└── main
                    		└── login-dialog.vue
            ```

            ![image](/uploads/8747ddd4f7ceaf5bf5fc6a35eec0ad5f/image.png)

             79,80번 라인의 `redirectURI`를 현재 환경에 맞는 `URI`로 변경시켜주고, 해당 하지 않는 URI는 주석처리한다.

            - `https://i5a501.p.ssafy.io/kakao/callback` : 배포용  

            - `https://localhost:8082/kakao/callback` : 로컬테스트용

<br>

- 카카오 로그인 방법
    - 개인의 카카오 계정으로 자유롭게 서비스 이용 가능

        (가입 시 모든 사항 동의 권장)

    - 계정이 없을 시 하단에 기재한 공용 아이디로 이용 권장
        - ID : doglivetest@kakao.com
        - PW : ssafy123


<br><br>


### 2. AWS S3 & CloudFront

- AWS S3와 CloudFront를 연동한 이미지 서버 활용
- 환경 설정
    - aws s3 서버의 계정 및 환경 정보가 담긴 `appliation-aws.yaml`파일을 `application.yaml`에 import 시켜놓은 상태  
    (추가 수정 필요 없음)


<br><br>

### 3. 웹소켓 채팅

- 로컬 테스트 시 url 변경 필요

    (ec2 배포시 변경할 필요 없음)

    1. chat-detail.vue

    ```bash
    frontend
    └── src
        └── views
        	└── chat
        		└── chat-detail.vue
    ```

    ![image](/uploads/c1592027a60b3bae36be5e85f4827cc1/image.png)

    291, 292번 라인의 `url`를 현재 환경에 맞는 URI로 변경시켜주고, 해당 하지 않는 URI는 주석처리한다.

    - `https://i5a501.p.ssafy.io/api/v1/chat-server` : 배포용
    - `https://localhost:8081/api/v1/chat-server` : 로컬테스트용
